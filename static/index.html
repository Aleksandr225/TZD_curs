<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/index.css">
    <title>Шифрование документа</title>
    
</head>

<body>
    <body>
    <div class="main-wrapper">
        <aside class="sidebar">
            <h2>Режимы работы программы</h2>
            <button class="cipher-btn active" onclick="selectMode(this, 'kuznechik')">Кузнечик (симм.)</button>
            <button class="cipher-btn" onclick="selectMode(this, 'rsa')">RSA (асимм.)</button>
            <button class="cipher-btn" onclick="selectMode(this, 'elgamal')">ElGamal (асимм.)</button>
            <button class="cipher-btn" onclick="selectMode(this, 'hash')">Хеширование</button>
            <button class="cipher-btn" onclick="selectMode(this, 'sign')">Выработка ЭЦП</button>
            <button class="cipher-btn" onclick="selectMode(this, 'keygen')">Генерация ключей</button>
        </aside>

        <div class="main-content">
            <div class="container">
                <h1>Шифрование документа</h1>
                <p>Загрузите файл для обработки (поддерживаемые форматы: .txt, .docx, .pdf и т.д.)</p>

                <!-- ЕДИНСТВЕННОЕ ПОЛЕ ЗАГРУЗКИ ФАЙЛА -->
                <div class="upload-section">
                    <label for="commonFileInput"><strong>Файл:</strong></label>
                    <input type="file" id="commonFileInput" accept=".txt,.docx,.pdf,.zip,.json,.xml">
                    <p id="fileNameDisplay" style="margin-top: 5px; font-size: 0.9em; color: #666;">Файл не выбран</p>
                </div>

                <p id="selectedModeDisplay">Выбран режим: <strong id="selectedModeName">Кузнечик (симм.)</strong></p>

                <!-- БЛОК ХЭШИРОВАНИЯ -->
                <div id="hashBlock" class="mode-block" style="display:none; margin-top:30px;">
                    <button type="button" id="hashButton" onclick="sendHash()">Посчитать хэш</button>
                    <div id="hashResult" style="margin-top:20px; display:none;">
                        <h2>Хэш файла (Стрибог-512):</h2>
                        <p id="hashValue" style="font-weight:bold; word-break: break-all;"></p>
                    </div>
                </div>

                <!-- Заглушка для остальных блоков (можно добавить позже) -->
                <div id="rsaBlock" class="mode-block" style="display:none;">[RSA: форма будет здесь]</div>
                <div id="elgamalBlock" class="mode-block" style="display:none;">[ElGamal: форма будет здесь]</div>
                <div id="signBlock" class="mode-block" style="display:none;">[ЭЦП: форма будет здесь]</div>
                <div id="keygenBlock" class="mode-block" style="display:none;">[Генерация ключей]</div>

                <!-- КНОПКА "ШИФРОВАТЬ" для симметричных режимов -->
                <button id="encryptButton" style="display:none; margin-top:20px;">Зашифровать</button>
            </div>
        </div>
    </div> <!-- .main-wrapper -->



    <script>

        // Отображаем имя выбранного файла
        document.getElementById('commonFileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const display = document.getElementById('fileNameDisplay');
            if (file) {
                display.textContent = `Выбран: ${file.name} (${(file.size / 1024).toFixed(1)} КБ)`;
            } else {
                display.textContent = 'Файл не выбран';
            }
        });

        function selectMode(btn, mode) {
            document.querySelectorAll('.cipher-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            // Обновляем скрытый input
            const input = document.getElementById('modeInput');
            if (input) input.value = mode;

            const nameMap = {
                kuznechik: 'Кузнечик (симм.)',
                rsa: 'RSA (асимм.)',
                elgamal: 'ElGamal (асимм.)',
                hash: 'Хеширование',
                sign: 'Выработка ЭЦП',
                keygen: 'Генерация ключей'
            };

            document.getElementById('selectedModeName').textContent = nameMap[mode] || mode;

            const blocks = {
                hash: document.getElementById("hashBlock"),
                rsa: document.getElementById("rsaBlock"),
                elgamal: document.getElementById("elgamalBlock"),
                sign: document.getElementById("signBlock"),
                keygen: document.getElementById("keygenBlock")
            };

            const encryptButton = document.getElementById("encryptButton");

            // Скрываем все блоки
            Object.values(blocks).forEach(b => { if (b) b.style.display = "none"; });
            encryptButton.style.display = "none";

            // Логика показа
            if (mode === "kuznechik") {
                encryptButton.style.display = "inline-block";
            } 
            else if (blocks[mode]) {
                blocks[mode].style.display = "block";
            }
        }

        // При загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('modeInput');
            const value = input?.value || 'kuznechik';

            const btn = Array.from(document.querySelectorAll('.cipher-btn'))
                .find(b => b.getAttribute('onclick')?.includes(`'${value}'`));

            if (btn) btn.classList.add('active');

            const map = {kuznechik:'Кузнечик (симм.)', rsa:'RSA (асимм.)', elgamal:'ElGamal (асимм.)', hash:'Хеширование', sign:'Выработка ЭЦП', keygen:'Генерация ключей'};
            const display = document.getElementById('selectedModeName');
            if (display) display.textContent = map[value] || value;

            // Имитируем клик, чтобы показать правильную форму
            if (btn) btn.click();
        });

    


// добавила отправку файла на бекенд 
        function sendHash() {
            const fileInput = document.getElementById("commonFileInput");
            const file = fileInput.files[0];
            if (!file) {
                alert("Сначала выберите файл!");
                return;
            }

            const formData = new FormData();
            formData.append("file", file);

            fetch("/get_file_hash", {
                method: "POST",
                body: formData
            })
            .then(r => r.json())
            .then(data => {
                const resultDiv = document.getElementById("hashResult");
                const hashValueEl = document.getElementById("hashValue");
                
                if (data.hash) {
                    hashValueEl.textContent = data.hash;
                    resultDiv.style.display = "block";
                } else {
                    hashValueEl.textContent = "Ошибка: " + (data.error || "неизвестная ошибка");
                    hashValueEl.style.color = "red";
                    resultDiv.style.display = "block";
                }
            })
            .catch(err => {
                console.error(err);
                alert("Ошибка при отправке: " + err.message);
            });
        }

        document.getElementById("fileForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            const formData = new FormData();
            formData.append("file", document.getElementById("fileInput").files[0]);
            formData.append("mode", document.getElementById("modeInput").value);

            const response = await fetch("/process", { method: "POST", body: formData });
            const data = await response.json();

            const resultBlock = document.getElementById("resultBlock");
            const resultText = document.getElementById("resultText");

            resultText.textContent = data.result || data.error;
            resultBlock.style.display = "block";
        });

    </script>
</body>
</html>











































































































<!-- <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Шифрование документа</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        form {
            margin-bottom: 20px;
        }
        input[type="file"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
        }
        .download-link {
            display: inline-block;
            background-color: #28a745;
            color: white;
            padding: 10px 15px;
            text-decoration: none;
            border-radius: 5px;
            margin-top: 10px;
        }
        .download-link:hover {
            background-color: #218838;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Шифрование документа</h1>
        <p>Загрузите файл для шифрования (поддерживаемые форматы: .txt, .docx, .pdf и т.д.). Приложение использует GOST-шифрование для защиты данных.</p>
        
        <form method="post" enctype="multipart/form-data">
            <label for="file">Выберите документ:</label>
            <input type="file" id="file" name="file" required accept=".txt,.docx,.pdf,.zip">
            <br>
            <button type="submit"> и скачать</button>
        </form>
        
        <div class="result {% if error %}error{% endif %}">
            <h2>{{value}}</h2>
            <p>Зашифрованный файл готов к скачиванию:</p>
            <a href="{{ download_url }}" class="download-link" download>Скачать зашифрованный документ</a>
        </div>
    </div>
</body>
</html> -->
