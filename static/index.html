<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/index.css">
    <title>–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞</title>
    
</head>

<body>
    <body>
    <div class="main-wrapper">
        <aside class="sidebar">
            <h2>–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã</h2>
            <button class="cipher-btn active" onclick="selectMode(this, 'kuznechik')">–ö—É–∑–Ω–µ—á–∏–∫ (—Å–∏–º–º.)</button>
            <button class="cipher-btn" onclick="selectMode(this, 'rsa')">RSA (–∞—Å–∏–º–º.)</button>
            <button class="cipher-btn" onclick="selectMode(this, 'elgamal')">ElGamal (–∞—Å–∏–º–º.)</button>
            <button class="cipher-btn" onclick="selectMode(this, 'hash')">–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
            <button class="cipher-btn" onclick="selectMode(this, 'sign')">–í—ã—Ä–∞–±–æ—Ç–∫–∞ –≠–¶–ü</button>
            <button class="cipher-btn" onclick="selectMode(this, 'keygen')">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π</button>
        </aside>

        <div class="main-content">
            <div class="container">
                <h1>–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h1>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: .txt, .docx, .pdf –∏ —Ç.–¥.)</p>

                <!-- –ï–î–ò–ù–°–¢–í–ï–ù–ù–û–ï –ü–û–õ–ï –ó–ê–ì–†–£–ó–ö–ò –§–ê–ô–õ–ê -->
                <div class="upload-section">
                    <label for="commonFileInput"><strong>–§–∞–π–ª:</strong></label>
                    <input type="file" id="commonFileInput" accept=".txt,.docx,.pdf,.zip,.json,.xml">
                    <p id="fileNameDisplay" style="margin-top: 5px; font-size: 0.9em; color: #666;">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</p>
                </div>

                <p id="selectedModeDisplay">–í—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º: <strong id="selectedModeName">–ö—É–∑–Ω–µ—á–∏–∫ (—Å–∏–º–º.)</strong></p>

                <!-- –ë–õ–û–ö –•–≠–®–ò–†–û–í–ê–ù–ò–Ø -->
                <div id="hashBlock" class="mode-block" style="display:none; margin-top:30px;">
                    <button type="button" id="hashButton" onclick="sendHash()">–ü–æ—Å—á–∏—Ç–∞—Ç—å —Ö—ç—à</button>
                    <div id="hashResult" style="margin-top:20px; display:none;">
                        <h2>–•—ç—à —Ñ–∞–π–ª–∞ (–°—Ç—Ä–∏–±–æ–≥-512):</h2>
                        <p id="hashValue" style="font-weight:bold; word-break: break-all;"></p>
                    </div>
                </div>

                <!-- –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ) -->
                <div id="rsaBlock" class="mode-block" style="display:none;">[RSA: —Ñ–æ—Ä–º–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å]</div>
                <div id="elgamalBlock" class="mode-block" style="display:none;">[ElGamal: —Ñ–æ—Ä–º–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å]</div>
                <div id="signBlock" class="mode-block" style="display:none;">[–≠–¶–ü: —Ñ–æ—Ä–º–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å]</div>
                <div id="keygenBlock" class="mode-block" style="display:none; margin-top:20px;">
                    <h2>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π</h2>
                    <p id="keygenDescription">–ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–æ–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å" ‚Äî –∑–∞—Ç–µ–º –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–ª–µ —Å –∫–ª—é—á–æ–º –∏ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è/—Å–∫–∞—á–∏–≤–∞–Ω–∏—è.</p>
                    <div class="keygen-controls" style="margin-top:12px;">
                        <button id="generateKeyButton" type="button">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á</button>
                        <div id="keyArea" style="display:none; margin-top:12px;">
                            <div class="input-with-copy">
                                <input id="generatedKeyInput" readonly placeholder="–ö–ª—é—á –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å..." />
                                <button id="copyKeyIcon" type="button" class="copy-icon" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å"></button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ö–ù–û–ü–ö–ê "–®–ò–§–†–û–í–ê–¢–¨" –¥–ª—è —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ -->
                <button id="encryptButton" style="display:none; margin-top:20px;">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div> <!-- .main-wrapper -->



    <script>

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–º—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        document.getElementById('commonFileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const display = document.getElementById('fileNameDisplay');
            if (file) {
                display.textContent = `–í—ã–±—Ä–∞–Ω: ${file.name} (${(file.size / 1024).toFixed(1)} –ö–ë)`;
            } else {
                display.textContent = '–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω';
            }
        });

        function selectMode(btn, mode) {
            document.querySelectorAll('.cipher-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç—ã–π input
            const input = document.getElementById('modeInput');
            if (input) input.value = mode;

            const nameMap = {
                kuznechik: '–ö—É–∑–Ω–µ—á–∏–∫ (—Å–∏–º–º.)',
                rsa: 'RSA (–∞—Å–∏–º–º.)',
                elgamal: 'ElGamal (–∞—Å–∏–º–º.)',
                hash: '–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ',
                sign: '–í—ã—Ä–∞–±–æ—Ç–∫–∞ –≠–¶–ü',
                keygen: '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π'
            };

            document.getElementById('selectedModeName').textContent = nameMap[mode] || mode;

            const blocks = {
                hash: document.getElementById("hashBlock"),
                rsa: document.getElementById("rsaBlock"),
                elgamal: document.getElementById("elgamalBlock"),
                sign: document.getElementById("signBlock"),
                keygen: document.getElementById("keygenBlock")
            };

            const encryptButton = document.getElementById("encryptButton");

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –±–ª–æ–∫–∏
            Object.values(blocks).forEach(b => { if (b) b.style.display = "none"; });
            encryptButton.style.display = "none";

            // –õ–æ–≥–∏–∫–∞ –ø–æ–∫–∞–∑–∞
            if (mode === "kuznechik") {
                encryptButton.style.display = "inline-block";
            } 
            else if (blocks[mode]) {
                blocks[mode].style.display = "block";
            }
            // –°–∫—Ä—ã–≤–∞–µ–º –æ–±–ª–∞—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –ø—Ä–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ä–µ–∂–∏–º–∞—Ö
            const uploadSection = document.querySelector('.upload-section');
            if (mode === 'keygen') {
                if (uploadSection) uploadSection.style.display = 'none';
            } else {
                if (uploadSection) uploadSection.style.display = '';
            }
        }

        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('modeInput');
            const value = input?.value || 'kuznechik';

            const btn = Array.from(document.querySelectorAll('.cipher-btn'))
                .find(b => b.getAttribute('onclick')?.includes(`'${value}'`));

            if (btn) btn.classList.add('active');

            const map = {kuznechik:'–ö—É–∑–Ω–µ—á–∏–∫ (—Å–∏–º–º.)', rsa:'RSA (–∞—Å–∏–º–º.)', elgamal:'ElGamal (–∞—Å–∏–º–º.)', hash:'–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ', sign:'–í—ã—Ä–∞–±–æ—Ç–∫–∞ –≠–¶–ü', keygen:'–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π'};
            const display = document.getElementById('selectedModeName');
            if (display) display.textContent = map[value] || value;

            // –ò–º–∏—Ç–∏—Ä—É–µ–º –∫–ª–∏–∫, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ–æ—Ä–º—É
            if (btn) btn.click();
        });

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Ä–∞–±–æ—Ç–∞ —Å –∫–ª—é—á–æ–º –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
        function generateKeyLocal(length = 64) {
            // length = —á–∏—Å–ª–æ hex-—Å–∏–º–≤–æ–ª–æ–≤; 64 hex = 32 –±–∞–π—Ç–∞
            const bytes = new Uint8Array(length / 2);
            if (window.crypto && crypto.getRandomValues) {
                crypto.getRandomValues(bytes);
            } else {
                // fallback: Math.random (–Ω–µ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ)
                for (let i = 0; i < bytes.length; i++) bytes[i] = Math.floor(Math.random() * 256);
            }
            return Array.from(bytes, b => ('0' + b.toString(16)).slice(-2)).join('').toUpperCase();
        }

        function showKeyOnUI(key) {
            const area = document.getElementById('keyArea');
            const input = document.getElementById('generatedKeyInput');
            if (!area || !input) return;
            input.value = key;
            area.style.display = 'block';
        }

        // –ü—Ä–∏–≤—è–∑–∫–∏ –∫–Ω–æ–ø–æ–∫
        const genBtn = document.getElementById('generateKeyButton');
        if (genBtn) {
            genBtn.addEventListener('click', (e) => {
                const key = generateKeyLocal(64);
                showKeyOnUI(key);
            });
        }

        const copyIcon = document.getElementById('copyKeyIcon');
        if (copyIcon) {
            // –¥–æ–±–∞–≤–∏–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª
            copyIcon.textContent = 'üìã';
            copyIcon.addEventListener('click', async () => {
                const input = document.getElementById('generatedKeyInput');
                if (!input || !input.value) return;
                try {
                    await navigator.clipboard.writeText(input.value);
                    alert('–ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
                } catch (err) {
                    // fallback
                    input.select();
                    document.execCommand('copy');
                    alert('–ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω (fallback)');
                }
            });
        }



    


// –¥–æ–±–∞–≤–∏–ª–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–∞–π–ª–∞ –Ω–∞ –±–µ–∫–µ–Ω–¥ 
        function sendHash() {
            const fileInput = document.getElementById("commonFileInput");
            const file = fileInput.files[0];
            if (!file) {
                alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!");
                return;
            }

            const formData = new FormData();
            formData.append("file", file);

            fetch("/get_file_hash", {
                method: "POST",
                body: formData
            })
            .then(r => r.json())
            .then(data => {
                const resultDiv = document.getElementById("hashResult");
                const hashValueEl = document.getElementById("hashValue");
                
                if (data.hash) {
                    hashValueEl.textContent = data.hash;
                    resultDiv.style.display = "block";
                } else {
                    hashValueEl.textContent = "–û—à–∏–±–∫–∞: " + (data.error || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
                    hashValueEl.style.color = "red";
                    resultDiv.style.display = "block";
                }
            })
            .catch(err => {
                console.error(err);
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: " + err.message);
            });
        }

        const fileFormEl = document.getElementById("fileForm");
        if (fileFormEl) {
            fileFormEl.addEventListener("submit", async function (e) {
            e.preventDefault();

            const formData = new FormData();
            formData.append("file", document.getElementById("fileInput").files[0]);
            formData.append("mode", document.getElementById("modeInput").value);

            const response = await fetch("/process", { method: "POST", body: formData });
            const data = await response.json();

            const resultBlock = document.getElementById("resultBlock");
            const resultText = document.getElementById("resultText");

            resultText.textContent = data.result || data.error;
            resultBlock.style.display = "block";
            });
        }

    </script>
</body>
</html>
