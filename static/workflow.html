<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/static/index.css">
    <link rel="stylesheet" href="/static/workflow.css">
    <title>–°—Ö–µ–º–∞ —É—á–µ—Ç–∞</title>
</head>
<body>
    <div class="top-tabs" role="navigation">
        <div class="top-tabs-inner container">
            <ul class="top-tab-bar" role="tablist">
                <li class="top-tab-item" data-href="/static/index.html">–†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏</li>
                <li class="top-tab-item" data-href="/static/workflow.html">–°—Ö–µ–º–∞ —É—á–µ—Ç–∞</li>
                <li class="top-tab-item" data-href="/static/forms.html">–§–æ—Ä–º—ã —É—á–µ—Ç–∞</li>
            </ul>
            <div class="top-user-info" aria-hidden="true">
                <div class="user-avatar" title="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å">A</div>
                <div class="user-name">–ê–ª–µ–∫—Å–∞–Ω–¥—Ä</div>
            </div>
        </div>
    </div>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –°—Ö–µ–º—ã —É—á–µ—Ç–∞ -->
    <div class="content-container">
        <h1 class="page-title">–°—Ö–µ–º—ã —É—á–µ—Ç–∞</h1>
        
        <!-- –ë–∞–Ω–Ω–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–ª—É—á–µ–Ω–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ -->
        <div id="documentNotification" class="document-notification" style="display: none;">
            <div class="notification-content">
                <span id="notificationText"></span>
                <button id="notificationDismiss" class="btn-small">‚úï</button>
            </div>
        </div>
        
        <div class="mode-description">
            <h2>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞</h2>
            <p>–ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—Ö–µ–º—ã —É—á–µ—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ö–µ–º—É –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ.</p>
        </div>
        
        <div class="upload-section">
            <h2>–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</h2>
            <div class="file-step">
                <span class="step-badge">1</span>
                <div class="file-select">
                    <button id="workflowUploadBtn" class="upload-button btn-small primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
                    </button>
                    <span id="workflowFileName" class="file-name">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</span>
                </div>
            </div>
        </div>
        
        <div class="document-form">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–∫—É–º–µ–Ω—Ç–µ</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞</label>
                    <input type="text" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞" id="docName">
                </div>
                <div class="form-group">
                    <label class="form-label">–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞</label>
                    <input type="text" class="form-input" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞" id="docType">
                </div>
                <div class="form-group">
                    <label class="form-label">–û—Ç–∫—É–¥–∞ –ø–æ—Å—Ç—É–ø–∏–ª</label>
                    <input type="text" class="form-input" placeholder="–£–∫–∞–∂–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫" id="docSource" value="–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–ö—É–∑–Ω–µ—á–∏–∫)">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">–ü–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞</label>
                <textarea class="form-input" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞" id="docFields"></textarea>
            </div>
        </div>
        
        <div class="document-preview">
            <h2>–ü—Ä–µ–¥–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞</h2>
            <div class="preview-placeholder" id="documentPreviewContent">
                <div class="preview-content-default">
                    –û–±–ª–∞—Å—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
                </div>
            </div>
        </div>
        
        <div class="doc-actions">
            <div>
                <button class="generate-button" id="generateWorkflowBtn">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
        
        <div class="workflow-section">
            <h2>–°—Ö–µ–º–∞ –ø—Ä–æ—Ö–æ–¥–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</h2>
            <div class="workflow-placeholder">
                <div class="preview-content-default">
                    –î–∏–∞–≥—Ä–∞–º–º–∞ –∏–ª–∏ —Å—Ö–µ–º–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ –∑–¥–µ—Å—å
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const items = document.querySelectorAll('.top-tab-item');
        items.forEach(it => it.addEventListener('click', function(){ 
            const href = this.getAttribute('data-href'); 
            if (href) { 
                window.location.href = href; 
            } 
        }));
        
        const path = window.location.pathname || '/';
        if (path.endsWith('/static/workflow.html')) {
            const el = document.querySelector('.top-tab-item[data-href="/static/workflow.html"]'); 
            if (el) el.classList.add('active');
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –∏–∑ index.html
        const documentSent = localStorage.getItem('documentSent');
        if (documentSent === 'true') {
            const fileData = JSON.parse(localStorage.getItem('sentDocument') || '{}');
            
            if (fileData && fileData.name) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                const notification = document.getElementById('documentNotification');
                const notificationText = document.getElementById('notificationText');
                const fileName = document.getElementById('workflowFileName');
                const docName = document.getElementById('docName');
                const docType = document.getElementById('docType');
                const docSource = document.getElementById('docSource');
                const preview = document.getElementById('documentPreviewContent');
                
                if (notification && notificationText) {
                    notification.style.display = 'block';
                    notificationText.textContent = `–ü–æ–ª—É—á–µ–Ω –¥–æ–∫—É–º–µ–Ω—Ç: ${fileData.name} (${formatBytes(fileData.size)})`;
                }
                
                if (fileName) {
                    fileName.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω: ${fileData.name} (${formatBytes(fileData.size)})`;
                    fileName.style.color = '#059669';
                    fileName.style.fontWeight = 'bold';
                }
                
                if (docName) {
                    const nameWithoutExt = fileData.name.replace(/\.[^/.]+$/, "");
                    docName.value = nameWithoutExt;
                }
                
                if (docType) {
                    const ext = fileData.name.split('.').pop().toUpperCase();
                    docType.value = `–§–∞–π–ª ${ext}`;
                }
                
                if (docSource) {
                    docSource.value = "–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–ö—É–∑–Ω–µ—á–∏–∫)";
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                if (preview && fileData.content) {
                    preview.innerHTML = '';
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                    if (fileData.type.startsWith('image/')) {
                        const img = document.createElement('img');
                        img.src = `data:${fileData.type};base64,${fileData.content}`;
                        img.alt = fileData.name;
                        img.style.maxWidth = '100%';
                        img.style.maxHeight = '180px';
                        img.style.borderRadius = '6px';
                        preview.appendChild(img);
                    } else if (fileData.type.includes('text') || fileData.name.endsWith('.txt')) {
                        try {
                            const text = atob(fileData.content);
                            const pre = document.createElement('pre');
                            pre.style.whiteSpace = 'pre-wrap';
                            pre.style.wordBreak = 'break-word';
                            pre.style.maxHeight = '180px';
                            pre.style.overflow = 'auto';
                            pre.style.padding = '10px';
                            pre.style.background = '#f8fafc';
                            pre.style.borderRadius = '6px';
                            pre.textContent = text.length > 1000 ? text.substring(0, 1000) + '...' : text;
                            preview.appendChild(pre);
                        } catch (e) {
                            preview.innerHTML = `<div class="preview-content-default">–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω: ${fileData.name}</div>`;
                        }
                    } else {
                        preview.innerHTML = `
                            <div style="text-align: center; padding: 20px;">
                                <div style="margin-bottom: 10px; font-size: 48px;">üìÑ</div>
                                <div style="font-weight: bold;">${fileData.name}</div>
                                <div style="color: #64748b; font-size: 14px; margin-top: 5px;">
                                    ${formatBytes(fileData.size)} ‚Ä¢ ${new Date(fileData.timestamp).toLocaleString()}
                                </div>
                                <button id="downloadReceivedFile" class="btn-small primary" style="margin-top: 15px;">
                                    –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
                                </button>
                            </div>
                        `;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                        document.getElementById('downloadReceivedFile').addEventListener('click', function() {
                            downloadFile(fileData);
                        });
                    }
                }
                
                // –û—á–∏—â–∞–µ–º —Ñ–ª–∞–≥ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
                localStorage.removeItem('documentSent');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
        function downloadFile(fileData) {
            try {
                const byteCharacters = atob(fileData.content);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: fileData.type });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileData.name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (e) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + e.message);
            }
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        const uploadButton = document.getElementById('workflowUploadBtn');
        if (uploadButton) {
            uploadButton.addEventListener('click', function() {
                alert('–§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞. –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞.');
            });
        }
        
        const generateButton = document.getElementById('generateWorkflowBtn');
        if (generateButton) {
            generateButton.addEventListener('click', function() {
                const docName = document.getElementById('docName').value;
                if (!docName.trim()) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∫—Ä–∞—Ç–∫–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞!');
                    return;
                }
                alert(`–î–æ–∫—É–º–µ–Ω—Ç "${docName}" —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ —É—á–µ—Ç–∞.`);
            });
        }
        
        const notificationDismiss = document.getElementById('notificationDismiss');
        if (notificationDismiss) {
            notificationDismiss.addEventListener('click', function() {
                const notification = document.getElementById('documentNotification');
                if (notification) {
                    notification.style.display = 'none';
                }
            });
        }
    });
    </script>
</body>
</html>